<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>官方页面</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { width: 100%; height: 100%; overflow: hidden; background: #fff; }
        /* 加载动画 */
        #loader { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .dots span { display: inline-block; width: 12px; height: 12px; border-radius: 50%; background: #ff0000; margin: 0 4px; animation: dotBounce 1.4s infinite ease-in-out both; }
        .dots span:nth-child(1) { animation-delay: -0.32s; }
        .dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes dotBounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        /* 提示样式 */
        #unauthorizedTip, #errorTip { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 20px; border-radius: 8px; font-size: 16px; text-align: center; max-width: 80%; display: none; }
        #unauthorizedTip { background: #ffebee; color: #d32f2f; border: 1px solid #ffcdd2; }
        #errorTip { background: #f5f5f5; color: #333; }
        /* 内容容器 */
        #contentFrame { width: 100%; height: 100vh; border: none; display: none; }
    </style>
    <script>
        // ===================== 目标URL域名授权配置（重点修改这里！）=====================
        // 仅允许跳转至以下授权域名，支持主域名、子域名（按需添加/删除）
        const AUTHORIZED_TARGET_DOMAINS = [
            "b7wwxs20.duia.eu",
            "beishang.cc",
            "new-domain1.com",
            "new-domain2.com"
        ];
        // =====================================================================
        // 验证解码后目标URL的域名是否在授权列表
        function isTargetAuthorized(targetUrl) {
            try {
                const targetDomain = new URL(targetUrl).hostname;
                // 匹配规则：完全一致 或 子域名匹配（如 a.xxx.com 匹配 xxx.com）
                return AUTHORIZED_TARGET_DOMAINS.some(authDomain => 
                    targetDomain === authDomain || targetDomain.endsWith(`.${authDomain}`)
                );
            } catch (e) {
                return false; // 解析失败视为未授权
            }
        }
        // 工具函数：获取跳转参数（u参数）
        function getJumpParam() {
            const search = window.location.search.slice(1);
            for (let item of search.split('&')) {
                const [key, value] = item.split('=');
                if (key === 'u') return decodeURIComponent(value || '');
            }
            return null;
        }
        // 工具函数：安全解码Base64跳转链接
        function decodeJumpUrl(encodedStr) {
            try {
                encodedStr = encodedStr.replace(/-/g, '+').replace(/_/g, '/');
                while (encodedStr.length % 4) encodedStr += '=';
                return decodeURIComponent(escape(atob(encodedStr)));
            } catch (e) {
                return null;
            }
        }
        // 主逻辑：解码URL → 验证目标域名 → 加载页面
        window.onload = function() {
            const loader = document.getElementById('loader');
            const unauthorizedTip = document.getElementById('unauthorizedTip');
            const errorTip = document.getElementById('errorTip');
            const frame = document.getElementById('contentFrame');

            // 1. 获取并解码跳转链接
            const encodedUrl = getJumpParam();
            if (!encodedUrl) {
                loader.style.display = 'none';
                errorTip.textContent = '缺少跳转链接，请检查u参数';
                errorTip.style.display = 'block';
                return;
            }

            const targetUrl = decodeJumpUrl(encodedUrl);
            if (!targetUrl || !/^https?:\/\//.test(targetUrl)) {
                loader.style.display = 'none';
                errorTip.textContent = '跳转链接无效，请重新生成';
                errorTip.style.display = 'block';
                return;
            }

            // 2. 验证目标域名是否授权
            if (!isTargetAuthorized(targetUrl)) {
                loader.style.display = 'none';
                unauthorizedTip.textContent = '❌ 目标域名未授权，禁止访问';
                unauthorizedTip.style.display = 'block';
                return;
            }

            // 3. 加载授权通过的页面
            frame.src = targetUrl;
            frame.onload = () => {
                loader.style.display = 'none';
                frame.style.display = 'block';
            };
            frame.onerror = () => {
                loader.style.display = 'none';
                errorTip.textContent = '页面加载失败，可能是跨域或链接失效';
                errorTip.style.display = 'block';
            };
        };
    </script>
</head>
<body>
    <div id="loader">
        <div class="dots">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
    <div id="unauthorizedTip">❌ 未授权访问请联系小醒<br>仅允许授权域名使用</div>
    <div id="errorTip"></div>
    <iframe id="contentFrame"></iframe>
</body>
</html>
